<h1>Финальный проект</h1>

Построить модель получения клиентом баланса по карте на банкоматом. Классы доменной модели ничего не должны знать о техническом окружении. Подробности технического окружения должны быть скрыты за слоями абстракции.

В качестве системы сборки должен использоваться Maven. В финальной версии приложение должно представлять из себя 2 Spring Boot приложения. Одно будет выполнять роль клиента\банкомата, а другое роль сервера. Приложение с ролью сервер должно хранить свои данные в базе данных H2. Для взаимодействия приложения должны использовать REST. Модули должны быть покрыты JUnit тестами.

Приложение с ролью сервер должно требовать аутентификации по логину и паролю с использованием Spring Security.

В качестве задания на 5+ приложения должны уметь переключаться на взаимодействие через Apache Kafka.

# Структура проекта:
* server-bank (банковская система)
* client-atm (банкомат)
* common (DTO)

## База данных
В проекте используется легковесная СУБД - H2.

**Таблица Customer**
| Поле   | Тип    |  Описание          |
|---------|-------|----------------    |
| id      | BIGINT | ID пользователя   | 
| first_name | VARCHAR(255) | Имя      |
| second_name | VARCHAR(255) | Фамиля  | 
| patronymic | VARCHAR(255) | Отчество |

**Таблица Account**
| Поле   | Тип    |  Описание          |
|---------|-------|----------------    |
| id      | BIGINT | ID аккаунта   | 
| id_customer | BIGINT | ID пользователя, к которому привязан Аккаунт |
| account_number | BIGINT | Номер аккаунта  | 
| balance | NUMERIC(20,2) | Баланс |

**Таблица Card**
| Поле   | Тип    |  Описание          |
|---------|-------|----------------    |
| id      | BIGINT | ID аккаунта   | 
| id_account | BIGINT | ID аккаунта, к которому привязана Карта |
| card_number | VARCHAR(20) | Номер карты  | 
| pin | VARCHAR(200) | Пин |
| status | VARCHAR(20) | Статус |

## DTO

**ClientAuthRequest**
| Поле  | Тип  |
|--------|-------|
| cardNumber | String |
| pin    | String |

**ServerAuthResponse**
| Поле  | Тип  |
|--------|-------|
| cardNumber | String |
| jwtToken    | String |

**ClinetMoneyDTO**
| Поле  | Тип  |
|--------|-------|
| money | BigDecimal |

**CustomerDTO**
| Поле  | Тип  |
|--------|-------|
| firstName | String |
| secondName    | String |
| patronymic | String |
| accounts    | Set<AccountDTO> |
  
  
**AccountDTO**
| Поле  | Тип  |
|--------|-------|
| accountNumber | String |
| balance    | BigDecimal |
| cards | Set<CardDTO> |
  
 **CardDTO**
| Поле  | Тип  |
|--------|-------|
| cardNumber | String |

## Безопасность
**В проекте реализована ауетификация по JWT-токену:**
  > Банковская система - Сервер. <br>
  > Банкомат - Клиент.
  
1. Банкомат отправляет Банковской системе запрос с номером карты и пинкодом, ожидая получить JWT-токен. 
2. Банковская система проверяет существование такой карты и соответствие пинкода в БД. На основе этого генерирует токен и отправляет Банкомату. Если карты не существует или пинкод не соответствует, то будет вызвано исключение, которое будет ответом для Банкомата. 
3. Банкомат хранит в своей памяти значение токена и использует его в последующих запросах, прикрпепляя в header.
4. Получая запрос от Клиента Сервер проверят валидность токена и его срок "жизни". Узнает за кем он закреплен и отправляет запрашиваемую информацию/совершает необходимые операции.
    
## Стек проекта
  * Java 8
  * Spring Boot
  * Spring Data
  * Spring Security + JJWT 
  * Project Lombok
  * H2DB
  * Maven

  








